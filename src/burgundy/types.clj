(ns burgundy.types
  (:require [burgundy.interop :refer :all]
            [burgundy.queue :refer :all]))

;; class data

(comment
  (def class-offset 0x010600D8)
  (def class-count 280)

  (def all-classes (map seq (cmd (contiguous-memory class-offset 312 class-count))))
  (def class-names (map #(apply str (map char (take 16 (drop 22 %)))) all-classes))
  (def class-keywords (map (name->keyword) class-names))

  (defn bytes->short [bytes]
    (bit-or (bit-shift-left (aget bytes 0) 8)
            (bit-and 0xff (int (aget bytes 1)))))

  (defn endian-flip
    "Flip the bytes of the two-byte number."
    [n]
    (assert (< n 0xFFFF))
    (+ (* 0x100 (rem n 0x100))
       (int (/ n 0x100))))

  (def class-types (map (comp
                         endian-flip
                         bytes->short
                         bytes
                         byte-array
                         (partial take 2)
                         (partial drop 136))
                        all-classes))

  (def class-type-kws (into (sorted-map) (zipmap class-types class-keywords)))
  ;; (def class-type-ids (zipmap class-keywords class-types))

  (defn dups [seq]
    (for [[id freq] (frequencies (map first seq)) i seq  ;; get the frequencies, destructure
          :when (and (= (first i) id) (> freq 1))]            ;; this is the filter condition
      i)))

(def class-type-kws
  {-64781 :fighter,
   -64771 :valkyrie,
   -64631 :archer,
   -64621 :owl-knight,
   -64611 :owl-sentry,
   -64601 :owl-ninja,
   -64591 :owl-mage,
   -64581 :soldier,
   -64571 :boar,
   -64561 :owl-sage,
   -64551 :amazon,
   -64541 :merman,
   -64531 :mermaid,
   -63791 :putty,
   -63781 :putty-monk,
   -63771 :puttyshaman,
   -63761 :putty-mage,
   -63751 :putty-smith,
   -63591 :manticore,
   -63581 :fenrir,
   -63571 :hell-corgi,
   -63561 :giga-beast,
   -63551 :cerberus,
   -63541 :behemoth,
   -63491 :slime,
   -63291 :werewolf,
   -63281 :lizardman,
   -63271 :dark-avatar,
   -63261 :dark-avatar,
   -62791 :dummy,
   -62781 :chromaoxide,
   -62771 :ninesword,
   -62761 :ninesword,
   -62751 :terror-demon,
   -62741 :terror-demon,
   -62731 :terror-demon,
   -62591 :werewolf,
   -62581 :cursed,
   -62571 :zombie,
   -62561 :raven-captain,
   -62551 :raven-captain,
   -62541 :puppeteer,
   -62531 :raven-captain,
   -62521 :cursed,
   -62511 :cursed,
   -62501 :dark-knight,
   -62491 :werewolf,
   -62291 :pringer-xx,
   -62281 :pringer-xxx,
   -62271 :watcher,
   -62261 :mysterious-girl,
   -62251 :parallel-d-girl,
   -62241 :death-merchant,
   -62231 :parallel-d-girl,
   -62221 :parallel-d-girl,
   -62071 :maronas-friend,
   -62061 :eternal-cameo,
   -62051 :prinny,
   -61791 :knife,
   -61781 :dagger,
   -61771 :stoneknife,
   -61761 :dirk,
   -61751 :bronzedag,
   -61741 :katana,
   -61731 :iron-ktna,
   -61721 :steel-ktna,
   -61711 :silver-ktna,
   -61701 :gold-ktna,
   -61561 :spirit-swd,
   -61551 :divine-swd,
   -61541 :stone-axe,
   -61531 :axe,
   -61521 :bronzeaxe,
   -61511 :iron-axe,
   -61501 :steel-axe,
   -61491 :silver-axe,
   -61481 :gold-axe,
   -61471 :snow-axe,
   -61461 :dark-axe,
   -61451 :star-axe,
   -61441 :battle-axe,
   -61311 :darkspear,
   -61301 :dream-spr,
   -61291 :spirit-spr,
   -61281 :dragonspr,
   -61271 :devilspear,
   -61261 :sacredspr,
   -61251 :divine-spr,
   -61241 :mace,
   -61231 :hammer,
   -61221 :dark-wpn,
   -61191 :wood-cane,
   -61051 :spiritstaff,
   -61041 :blackstaff,
   -61031 :wisdom-stf,
   -61021 :devil-staff,
   -61011 :sacred-stf,
   -61001 :divine-stf,
   -60991 :book,
   -60981 :used-book,
   -60971 :dictionary,
   -60961 :spell-book,
   -60951 :secret-bk,
   -60941 :hintguide,
   -60931 :encyc,
   -60791 :tree,
   -60781 :old-tree,
   -60771 :sapling,
   -60761 :giant-tree,
   -60751 :cursed-tr,
   -60741 :spiritree,
   -60731 :sacred-tr,
   -60721 :devil-tree,
   -60711 :divinetree,
   -60691 :weed,
   -60681 :flower,
   -60541 :poisonrck,
   -60531 :rock-weed,
   -60521 :sacredrck,
   -60511 :devilrckwd,
   -60491 :dead-tree,
   -60481 :rotten-tr,
   -60471 :wither-tr,
   -60461 :deadwood,
   -60451 :cursetree,
   -60441 :wight-tree,
   -60431 :blasphtr,
   -60421 :skull-tree,
   -60281 :trolly,
   -60271 :bomb,
   -60261 :pillar,
   -60251 :starfish,
   -60241 :driftwood,
   -60231 :pot,
   -60221 :water-can,
   -60211 :candle,
   -60201 :hourglass,
   -60191 :phonogrph,
   -60181 :bread,
   -60171 :sign,
   -60161 :egg,
   -59991 :fishcake,
   -59981 :steel-alloy,
   -59971 :weed?,
   -59961 :rainbow-shell,
   -59951 :sunflower-sword,
   -59941 :fan,
   -59931 :bell,
   -59921 :watermelon,
   -59911 :bonfire,
   -126 :mutant-blob,
   1 :chroma,
   2 :phantom,
   3 :chroma,
   4 :chromaoxide,
   5 :ninesword,
   6 :ninesword,
   7 :werewolf,
   8 :zombie,
   9 :raven-captain,
   10 :raven-captain,
   20 :puppeteer,
   30 :raven-captain,
   100 :mutant-slime,
   110 :mutant-shade,
   120 :mutant-mimic,
   1030 :blacksmith,
   1040 :fusionist,
   1050 :titlist,
   1060 :witch,
   1070 :mystic,
   1080 :healer,
   1090 :dungeonmonk,
   1100 :merchant,
   1110 :zombie,
   1120 :lady-zombie,
   1130 :old-man,
   1140 :granny,
   1150 :knight,
   2050 :scrabbit,
   2060 :funguy,
   2070 :saber-kitty,
   2080 :bottlemail,
   2100 :dragon,
   2110 :golem,
   2310 :shade,
   2320 :mimic,
   2330 :blob,
   2400 :ghost,
   2410 :whisp,
   2420 :summon,
   3100 :overlord,
   3110 :beauty-queen,
   3120 :fallen-angel,
   3140 :prinny,
   3150 :dark-adonis,
   3160 :brave,
   3170 :spoiled-brat,
   3400 :terror-demon,
   3410 :pringer-x,
   3700 :badass-overlord,
   3710 :hero,
   4100 :snow-ktna,
   4110 :prize-ktna,
   4120 :sword,
   4130 :widesword,
   4140 :long-swd,
   4150 :bronze-swd,
   4160 :iron-swd,
   4170 :blade,
   4180 :steel-swd,
   4190 :sacredswd,
   4200 :gilded-swd,
   4210 :snowswd,
   4220 :prize-swd,
   4360 :big-axe,
   4370 :giant-axe,
   4380 :devil-axe,
   4390 :demon-axe,
   4400 :spear,
   4410 :bronzespr,
   4420 :longspear,
   4430 :iron-spear,
   4440 :steel-spr,
   4450 :silver-spr,
   4460 :gold-spear,
   4470 :snowspear,
   4610 :cane,
   4620 :stonecane,
   4630 :bronze-stf,
   4640 :iron-staff,
   4650 :steelstaff,
   4660 :silver-stf,
   4670 :gold-staff,
   4680 :snow-staff,
   4690 :fusion-stf,
   4700 :dark-cane,
   4710 :dream-stf,
   4720 :star-staff,
   4730 :dead-staff,
   4870 :must-read,
   4880 :lthograph,
   4890 :cert,
   4900 :netherbk,
   4910 :divinebook,
   4920 :spirit-sword,
   4930 :black-sword,
   4940 :witch-cane,
   4950 :hero-sword,
   4960 :changebook,
   5120 :mushroom,
   5130 :sunflower,
   5140 :cactus,
   5150 :cactus,
   5160 :cactus,
   5170 :blossom,
   5180 :misc-weed,
   5200 :rock,
   5210 :stone,
   5220 :crystal,
   5230 :anthill,
   5240 :evlrockwd,
   5380 :angel-tree,
   5400 :stump,
   5410 :brick,
   5420 :vase,
   5430 :pumpkin,
   5440 :crate,
   5450 :fish,
   5460 :treasure,
   5470 :seed,
   5480 :barrel,
   5490 :skull,
   5500 :bone,
   5670 :remote,
   5700 :mailbox,
   5890 :shell,
   5900 :spirit-sword,
   5910 :black-sword,
   5920 :core})
