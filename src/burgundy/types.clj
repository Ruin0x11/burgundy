(ns burgundy.types
  (:require [burgundy.interop :refer :all]
            [burgundy.queue :refer :all]))

;; class data

(comment
  (def class-offset 0x010600D8)
  (def class-count 280)

  (def all-classes (map seq (cmd (contiguous-memory class-offset 312 class-count))))
  (def class-names (map #(apply str (map char (take 16 (drop 22 %)))) all-classes))
  (def class-keywords (map (name->keyword) class-names))

  (defn bytes->short [bytes]
    (bit-and 0xFFFF
             (bit-or (bit-shift-left (aget bytes 0) 8)
                     (bit-and 0xff (int (aget bytes 1))))))

  (defn endian-flip
    "Flip the bytes of the two-byte number."
    [n]
    (assert (< n 0xFFFF))
    (+ (* 0x100 (rem n 0x100))
       (int (/ n 0x100))))

  (def class-types (map (comp
                         endian-flip
                         bytes->short
                         bytes
                         byte-array
                         (partial take 2)
                         (partial drop 136))
                        all-classes))

  (def class-type-kws (into (sorted-map) (zipmap class-types class-keywords))))

(def class-type-kws
  {1 :chroma,
   2 :phantom,
   3 :chroma,
   4 :chromaoxide,
   5 :ninesword,
   6 :ninesword,
   7 :werewolf,
   8 :zombie,
   9 :raven-captain,
   10 :raven-captain,
   20 :puppeteer,
   30 :raven-captain,
   100 :mutant-slime,
   110 :mutant-shade,
   120 :mutant-mimic,
   130 :mutant-blob,
   1010 :fighter,
   1020 :valkyrie,
   1030 :blacksmith,
   1040 :fusionist,
   1050 :titlist,
   1060 :witch,
   1070 :mystic,
   1080 :healer,
   1090 :dungeonmonk,
   1100 :merchant,
   1110 :zombie,
   1120 :lady-zombie,
   1130 :old-man,
   1140 :granny,
   1150 :knight,
   1160 :archer,
   1170 :owl-knight,
   1180 :owl-sentry,
   1190 :owl-ninja,
   1200 :owl-mage,
   1210 :soldier,
   1220 :boar,
   1230 :owl-sage,
   1240 :amazon,
   1250 :merman,
   1260 :mermaid,
   2000 :putty,
   2010 :putty-monk,
   2020 :puttyshaman,
   2030 :putty-mage,
   2040 :putty-smith,
   2050 :scrabbit,
   2060 :funguy,
   2070 :saber-kitty,
   2080 :bottlemail,
   2100 :dragon,
   2110 :golem,
   2200 :manticore,
   2210 :fenrir,
   2220 :hell-corgi,
   2230 :giga-beast,
   2240 :cerberus,
   2250 :behemoth,
   2300 :slime,
   2310 :shade,
   2320 :mimic,
   2330 :blob,
   2400 :ghost,
   2410 :whisp,
   2420 :summon,
   2500 :werewolf,
   2510 :lizardman,
   2520 :dark-avatar,
   2530 :dark-avatar,
   3000 :dummy,
   3010 :chromaoxide,
   3020 :ninesword,
   3030 :ninesword,
   3040 :terror-demon,
   3050 :terror-demon,
   3060 :terror-demon,
   3100 :overlord,
   3110 :beauty-queen,
   3120 :fallen-angel,
   3140 :prinny,
   3150 :dark-adonis,
   3160 :brave,
   3170 :spoiled-brat,
   3200 :werewolf,
   3210 :cursed,
   3220 :zombie,
   3230 :raven-captain,
   3240 :raven-captain,
   3250 :puppeteer,
   3260 :raven-captain,
   3270 :cursed,
   3280 :cursed,
   3290 :dark-knight,
   3300 :werewolf,
   3400 :terror-demon,
   3410 :pringer-x,
   3500 :pringer-xx,
   3510 :pringer-xxx,
   3520 :watcher,
   3530 :mysterious-girl,
   3540 :parallel-d-girl,
   3550 :death-merchant,
   3560 :parallel-d-girl,
   3570 :parallel-d-girl,
   3700 :badass-overlord,
   3710 :hero,
   3720 :maronas-friend,
   3730 :eternal-cameo,
   3740 :prinny,
   4000 :knife,
   4010 :dagger,
   4020 :stoneknife,
   4030 :dirk,
   4040 :bronzedag,
   4050 :katana,
   4060 :iron-ktna,
   4070 :steel-ktna,
   4080 :silver-ktna,
   4090 :gold-ktna,
   4100 :snow-ktna,
   4110 :prize-ktna,
   4120 :sword,
   4130 :widesword,
   4140 :long-swd,
   4150 :bronze-swd,
   4160 :iron-swd,
   4170 :blade,
   4180 :steel-swd,
   4190 :sacredswd,
   4200 :gilded-swd,
   4210 :snowswd,
   4220 :prize-swd,
   4230 :spirit-swd,
   4240 :divine-swd,
   4250 :stone-axe,
   4260 :axe,
   4270 :bronzeaxe,
   4280 :iron-axe,
   4290 :steel-axe,
   4300 :silver-axe,
   4310 :gold-axe,
   4320 :snow-axe,
   4330 :dark-axe,
   4340 :star-axe,
   4350 :battle-axe,
   4360 :big-axe,
   4370 :giant-axe,
   4380 :devil-axe,
   4390 :demon-axe,
   4400 :spear,
   4410 :bronzespr,
   4420 :longspear,
   4430 :iron-spear,
   4440 :steel-spr,
   4450 :silver-spr,
   4460 :gold-spear,
   4470 :snowspear,
   4480 :darkspear,
   4490 :dream-spr,
   4500 :spirit-spr,
   4510 :dragonspr,
   4520 :devilspear,
   4530 :sacredspr,
   4540 :divine-spr,
   4550 :mace,
   4560 :hammer,
   4570 :dark-wpn,
   4600 :wood-cane,
   4610 :cane,
   4620 :stonecane,
   4630 :bronze-stf,
   4640 :iron-staff,
   4650 :steelstaff,
   4660 :silver-stf,
   4670 :gold-staff,
   4680 :snow-staff,
   4690 :fusion-stf,
   4700 :dark-cane,
   4710 :dream-stf,
   4720 :star-staff,
   4730 :dead-staff,
   4740 :spiritstaff,
   4750 :blackstaff,
   4760 :wisdom-stf,
   4770 :devil-staff,
   4780 :sacred-stf,
   4790 :divine-stf,
   4800 :book,
   4810 :used-book,
   4820 :dictionary,
   4830 :spell-book,
   4840 :secret-bk,
   4850 :hintguide,
   4860 :encyc,
   4870 :must-read,
   4880 :lthograph,
   4890 :cert,
   4900 :netherbk,
   4910 :divinebook,
   4920 :spirit-sword,
   4930 :black-sword,
   4940 :witch-cane,
   4950 :hero-sword,
   4960 :changebook,
   5000 :tree,
   5010 :old-tree,
   5020 :sapling,
   5030 :giant-tree,
   5040 :cursed-tr,
   5050 :spiritree,
   5060 :sacred-tr,
   5070 :devil-tree,
   5080 :divinetree,
   5100 :weed,
   5110 :flower,
   5120 :mushroom,
   5130 :sunflower,
   5140 :cactus,
   5150 :cactus,
   5160 :cactus,
   5170 :blossom,
   5180 :misc-weed,
   5200 :rock,
   5210 :stone,
   5220 :crystal,
   5230 :anthill,
   5240 :evlrockwd,
   5250 :poisonrck,
   5260 :rock-weed,
   5270 :sacredrck,
   5280 :devilrckwd,
   5300 :dead-tree,
   5310 :rotten-tr,
   5320 :wither-tr,
   5330 :deadwood,
   5340 :cursetree,
   5350 :wight-tree,
   5360 :blasphtr,
   5370 :skull-tree,
   5380 :angel-tree,
   5400 :stump,
   5410 :brick,
   5420 :vase,
   5430 :pumpkin,
   5440 :crate,
   5450 :fish,
   5460 :treasure,
   5470 :seed,
   5480 :barrel,
   5490 :skull,
   5500 :bone,
   5510 :trolly,
   5520 :bomb,
   5530 :pillar,
   5540 :starfish,
   5550 :driftwood,
   5560 :pot,
   5570 :water-can,
   5580 :candle,
   5590 :hourglass,
   5600 :phonogrph,
   5610 :bread,
   5620 :sign,
   5630 :egg,
   5670 :remote,
   5700 :mailbox,
   5800 :fishcake,
   5810 :steel-alloy,
   5820 :weed?,
   5830 :rainbow-shell,
   5840 :sunflower-sword,
   5850 :fan,
   5860 :bell,
   5870 :watermelon,
   5880 :bonfire,
   5890 :shell,
   5900 :spirit-sword,
   5910 :black-sword,
   5920 :core})
